"A datetime string with format `Y-m-d H:i:s`, e.g. `2018-01-01 13:00:00`."
scalar DateTime @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

"A date string with format `Y-m-d`, e.g. `2011-05-23`."
scalar Date @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\Date")

type Query {
    #me
    me: User @auth(guard: "api")
    #Query proyectos
    project(name: String! @eq): Project @find(model: "App\\Project") @middleware(checks:["auth:api","permission:buscar proyecto"])
    projects: [Project!]! @all(model: "App\\Project") @middleware(checks:["auth:api","permission:listar proyectos"])
    projects_paginator: [Project]! @paginate(type: "paginator" model: "App\\Project") @middleware(checks:["auth:api","permission:Listar proyectos"])
    #projectsSearchName(order: String! ): [Project!]! @paginate(scopes: ["filterByName"])
    #projectsSearchName(name: String @whereLike(filter: "wildcard")): [Project!]!
    #Query Usuarios
    user(name: String! @eq): User @find(model: "App\\User") @middleware(checks:["auth:api","permission:buscar usuario"])
    users: [User!]! @all(model: "App\\User") @middleware(checks:["auth:api","permission:listar usuarios"])
    users_paginator: [User]! @paginate(type: "paginator" model: "App\\User") @middleware(checks:["auth:api","permission:listar usuarios"])
    #Query roles
    role(name: String! @eq): Role @find(model: "Spatie\\Permission\\Models\\Role") @middleware(checks:["auth:api","permission:buscar rol"])
    roles: [Role!]! @all(model: "Spatie\\Permission\\Models\\Role") @middleware(checks:["auth:api","permission:listar roles"])
    roles_paginator: [Role]! @paginate(type: "paginator" model: "Spatie\\Permission\\Models\\Role") @middleware(checks:["auth:api","permission:listar roles"])
    #Query permissions
    permission(name: String! @eq): Permission @find(model: "Spatie\\Permission\\Models\\Permission") @middleware(checks:["auth:api","permission:buscar permiso"])
    permissions: [Permission!]! @all(model: "Spatie\\Permission\\Models\\Permission") @middleware(checks:["auth:api","permission:listar permisos"])
    permissions_paginator: [Permission]! @paginate(type: "paginator" model: "Spatie\\Permission\\Models\\Permission") @middleware(checks:["auth:api","permission:listar permisos"])
    #Contacts para hacer interface
    #contacts: [Contact!]! @all(model: "App\\Contact") #@interface(resolver: "App\\GraphQL\\Interfaces\\Contact@resolveType") @middleware(checks:["auth:api","permission:listar contactos"])
    #contacts_paginator: [Contact]! @paginate(type: "paginator" model: "App\\Contact")# @middleware(checks:["auth:api","permission:listar contactos"])
    #contact(name: String! @eq): Contact @find(model: "App\\Contact")# @middleware(checks:["auth:api","permission:buscar contacto"])
    contact(name: String! @eq): Person @find(model: "App\\Contact") @middleware(checks:["auth:api","permission:buscar contacto"])
    contacts: [Person!]! @all(model: "App\\Contact") @middleware(checks:["auth:api","permission:listar contactos"])
    contacts_paginator: [Person]! @paginate(type: "paginator" model: "App\\Contact")@middleware(checks:["auth:api","permission:listar contactos"])
    #Members
    members: [Member] @paginate(type: "paginator" model: "App\\Member") @middleware(checks:["auth:api","permission:listar miembros"])
    #Categories
    category(name: String! @eq): Category @find(model: "App\\Category")@middleware(checks:["auth:api","permission:buscar categoria"])
    categories: [Category!]! @all(model: "App\\Category") @middleware(checks:["auth:api","permission:listar categorias"])
    categories_paginator: [Category] @paginate(type: "paginator" model: "App\\Category")@middleware(checks:["auth:api","permission:listar categorias"])
    #Products
    product(name: String! @eq): Product @find(model: "App\\Product")@middleware(checks:["auth:api","permission:buscar producto"])
    products: [Product!]! @all(model: "App\\Product") @middleware(checks:["auth:api","permission:listar productos"])
    products_paginator: [Product] @paginate(type: "paginator" model: "App\\Product")@middleware(checks:["auth:api","permission:listar productos"])
    #Orders
    order(code: String! @eq): Order @find(model: "App\\Order")@middleware(checks:["auth:api","permission:buscar orden"])
    orders: [Order!]! @all(model: "App\\Order") @middleware(checks:["auth:api","permission:listar ordenes"])
    orders_paginator: [Order] @paginate(type: "paginator" model: "App\\Order")@middleware(checks:["auth:api","permission:listar ordenes"])

}

#Detales
type Detail{
    id_detalle: ID!
    product:Product!
    order:Order!
    quantity:Int!
    value:Int!
    cost:Int!
    measure:String
}
#Ordenes
type Order{
    id_order: ID!
    member:Member!
    name:String!
    code:String!
    description:String
    date_order: Date!
    notes:String
    details:[Detail!]!
}
#Productos
type Product{
    id_product:ID!
    category:Category!
    name:String!
    description:String
    precio:Int
    amount:Int
}
#Categorias
type Category{
    id_category:ID!
    name:String!
    description:String
    Products:[Product!]!
}
#Miembros
type Member{
    id_members:ID!
    project:Project!
    contact:Person!
    rol:Role!
    hours_week:Int
    hours_month:Int
    state:Int!
    orders:[Order]
}
#interface Contact{
#    id_contact:ID!
#    type:contactType!
#    name:String!
#    identification_type:contactIdType!
#    identification_number:Int!
#    email:String!
#    phones:String!
#    state:Int!
#    address:String
#    web_site:String
#}
type Person{ #implements Contact
    id_contact:ID!
    id_parent_contact:Int
    id_job:Int
    type:contactType!
    name:String!
    lastname:String
    identification_type:contactIdType!
    identification_number:Int!
    email:String!
    phones:String!
    state:Int!
    address:String
    web_site:String
}

type Company{ #implements Contact
    id_contact:ID!
    type:contactType!
    name:String!
    identification_type:contactIdType!
    identification_number:Int!
    email:String!
    phones:String!
    state:Int!
    locate:String
    city:String
    address:String
    web_site:String
}
#tipos de contacto
enum contactType{
    persona @enum(value: 1)
    empresa @enum(value: 2)
}
#Tipo de identificacion
enum contactIdType{
    CC @enum(value: 1)
    nit @enum(value: 2)
    pasaporte @enum(value: 3)
    extranjera @enum(value: 4)
}
#Proyecto
type Project {
    id_project: ID!
    parent_project:Project
    name: String!
    start_date: Date!
    end_date: Date!
    description: String
    contract_value: Int!
    expenses: Int!
    process: Int!
    state: String
    members: [Member]
}
#Estados proyecto
enum statesProject {
    proceso
    finalizado
    archivado
}
#Categorias del Proyecto
enum categoryProject {
    estudioSuelo @enum(value: 1)
    obraCivil @enum(value: 2)
}

type Role {
  id: ID!
  name: String!
  guard_name: String!
  created_at: Date!
  updated_at: Date!
  permissions: [Permission]
}

type Permission {
  id: ID!
  name: String!
  guard_name: String!
  created_at: Date!
  updated_at: Date!
}

type User {
    id: ID!
    name: String!
    email: String!
    roles: [Role]
}

input LoginInput {
    username: String!
    password: String!
}

input RefreshTokenInput {
    refresh_token: String
}

type AuthPayload {
    access_token: String!
    refresh_token: String!
    expires_in: Int!
    token_type: String!
    user: User!
}

type RefreshTokenPayload {
    access_token: String!
    refresh_token: String!
    expires_in: Int!
    token_type: String!
}

type LogoutResponse {
    status: String!
    message: String
}

type ForgotPasswordResponse {
    status: String!
    message: String
}

input ForgotPasswordInput {
    email: String!
}

input NewPasswordWithCodeInput {
    email: String!
    token: String!
    password: String!
    password_confirmation: String!
}

#input ContactInput{
#    id_parent_contact: Int @rules(apply: ["integer"])
#    id_job: Int @rules(apply: ["integer"])
#    type: contactType @rules(apply: ["integer"])
#    name: String @rules(apply: ["required", "max:255"])
#    lastname: String @rules(apply: ["required", "max:255"])
#    identification_type: contactIdType @rules(apply: ["required"])
#    identification_number: Int @rules(apply: ["required"])
#    email: String @rules(apply: ["required", "max:255"])
#    phones:String @rules(apply: ["max:30"])
#    state:Int @rules(apply: ["required"])
#    locate:String @rules(apply: ["max:255"])
#    city:String @rules(apply: ["max:255"])
#    address:String @rules(apply: ["max:255"])
#    web_site:String @rules(apply: ["max:255"])
#}

type Mutation {
    #Auth
    login(data: LoginInput): AuthPayload! @field(resolver: "Joselfonseca\\LighthouseGraphQLPassport\\GraphQL\\Mutations\\Login@resolve")
    refreshToken(data: RefreshTokenInput): RefreshTokenPayload! @field(resolver: "Joselfonseca\\LighthouseGraphQLPassport\\GraphQL\\Mutations\\RefreshToken@resolve")
    logout: LogoutResponse! @field(resolver: "Joselfonseca\\LighthouseGraphQLPassport\\GraphQL\\Mutations\\Logout@resolve")
    forgotPassword(data: ForgotPasswordInput!): ForgotPasswordResponse! @field(resolver: "Joselfonseca\\LighthouseGraphQLPassport\\GraphQL\\Mutations\\ForgotPassword@resolve")
    updateForgottenPassword(data: NewPasswordWithCodeInput): ForgotPasswordResponse! @field(resolver: "Joselfonseca\\LighthouseGraphQLPassport\\GraphQL\\Mutations\\ResetPassword@resolve")
    #projects
    createProject(id_parent: categoryProject @rules(apply: ["integer"]) name: String @rules(apply: ["required", "alpha", "max:255"]) start_date: Date @rules(apply: ["required", "date"]) end_date: Date @rules(apply: ["required", "date"]) description: String @rules(apply: ["nullable"]) contract_value: Int @rules(apply: ["required"]) expenses: Int @rules(apply: ["required", "integer"]) process: Int @rules(apply: ["required", "integer"]) state: String @rules(apply: ["required", "in:proceso,finalizado,archivado"])): Project @create(model: "App\\Project") @middleware(checks:["auth:api","permission:agregar proyecto"])
    updateProject(id_project: ID! @rules(apply: ["required"])id_parent: categoryProject @rules(apply: ["integer"])name: String @rules(apply: ["required", "alpha", "max:255"])start_date: Date @rules(apply: ["required", "date"])end_date: Date @rules(apply: ["required", "date"])description: String @rules(apply: ["nullable", "string"])contract_value: Int @rules(apply: ["required"])expenses: Int @rules(apply: ["required", "integer"])process: Int @rules(apply: ["required", "integer"])state: String @rules(apply: ["required", "in:proceso,finalizado,archivado"])): Project @update(model: "App\\Project") @middleware(checks:["auth:api","permission:editar proyecto"])
    updateStateProject(id_project: ID! @rules(apply: ["required"]) state: String @rules(apply: ["required", "in:proceso,finalizado,archivado"])): Project @update(model: "App\\Project") @middleware(checks:["auth:api","permission:cambiar estado proyecto"])
    #deleteProject(id_project: ID! @rules(apply: ["required"])): Project @delete(model: "App\\Project") @middleware(checks:["auth:api"])
    #Contacts
    #createContact(input: ContactInput!): Contact @create(model: "App\\Contact") #@middleware(checks:["auth:api","permission:agregar contacto"])
    #updateProject(id_project: ID! @rules(apply: ["required"])id_parent: Int @rules(apply: ["integer"])name: String @rules(apply: ["required", "alpha", "max:255"])start_date: Date @rules(apply: ["required", "date", "before:tomorrow"])end_date: Date @rules(apply: ["required", "date", "after:tomorrow"])description: String @rules(apply: ["nullable", "string"])contract_value: Int @rules(apply: ["required"])expenses: Int @rules(apply: ["required", "integer"])process: Int @rules(apply: ["required", "integer"])state: String @rules(apply: ["required", "in:proceso,finalizado,archivado"])): Project @update(model: "App\\Project") @middleware(checks:["auth:api","permission:editar proyecto"])
    #updateStateProject(id_project: ID! @rules(apply: ["required"]) state: String @rules(apply: ["required", "in:proceso,finalizado,archivado"])): Project @update(model: "App\\Project") @middleware(checks:["auth:api","permission:cambiar estado proyecto"])

    #Person
    createPerson(id_parent_contact: Int @rules(apply: ["integer"])id_job: Int @rules(apply: ["integer"])type: contactType @rules(apply: ["integer"])name: String @rules(apply: ["required", "max:255"])lastname: String @rules(apply: ["required", "max:255"])identification_type: contactIdType @rules(apply: ["integer"])identification_number: Int @rules(apply: ["required"])email: String @rules(apply: ["required", "max:255"])phones:String @rules(apply: ["max:30"])state:Int @rules(apply: ["required"])address:String @rules(apply: ["max:255"])web_site:String @rules(apply: ["max:255"])): Person @create(model: "App\\Contact")
    updatePerson(id_contact: ID! @rules(apply: ["required"])id_parent_contact: Int @rules(apply: ["integer"])id_job: Int @rules(apply: ["integer"])type: contactType @rules(apply: ["integer"])name: String @rules(apply: ["required", "max:255"])lastname: String @rules(apply: ["required", "max:255"])identification_type: contactIdType @rules(apply: ["integer"])identification_number: Int @rules(apply: ["required"])email: String @rules(apply: ["required", "max:255"])phones:String @rules(apply: ["max:30"])state:Int @rules(apply: ["required"])address:String @rules(apply: ["max:255"])web_site:String @rules(apply: ["max:255"])): Person @update(model: "App\\Contact")
    createCompany(type: contactType @rules(apply: ["integer"])name: String @rules(apply: ["required", "max:255"])identification_type: contactIdType @rules(apply: ["required"])identification_number: Int @rules(apply: ["required"])email: String @rules(apply: ["required", "max:255"])phones:String @rules(apply: ["max:30"])state:Int @rules(apply: ["required"])locate:String @rules(apply: ["max:255"])city:String @rules(apply: ["max:255"])address:String @rules(apply: ["max:255"])web_site:String @rules(apply: ["max:255"])): Company @create(model: "App\\Contact")
    updateCompany(id_contact: ID! @rules(apply: ["required"])type: contactType @rules(apply: ["integer"])name: String @rules(apply: ["required", "max:255"])identification_type: contactIdType @rules(apply: ["required"])identification_number: Int @rules(apply: ["required"])email: String @rules(apply: ["required", "max:255"])phones:String @rules(apply: ["max:30"])state:Int @rules(apply: ["required"])locate:String @rules(apply: ["max:255"])city:String @rules(apply: ["max:255"])address:String @rules(apply: ["max:255"])web_site:String @rules(apply: ["max:255"])): Company @update(model: "App\\Contact")
    #member
    member_has_project(
        id_project: Int! @rules(apply: ["integer"])
        id_contact: Int! @rules(apply: ["integer"])
        id_rol:     Int! @rules(apply: ["integer"])
        hours_week: Int  @rules(apply: ["integer"])
        hours_month:Int  @rules(apply: ["integer"])
        state:  Int = 1
        ):Member @create(model: "App\\Member")
    #Category
    createCategory(
        name: String @rules(apply: ["required", "max:255"])
        description: String @rules(apply: ["max:255"])
    ): Category @create(model: "App\\Category")
    updateCategory(
        id_category: ID! @rules(apply: ["required"])
        name: String @rules(apply: ["required", "max:255"])
        description: String @rules(apply: ["max:255"])
    ): Category @update(model: "App\\Category")
    #Product
    createProduct(
        id_category: Int! @rules(apply: ["required","integer"])
        name: String! @rules(apply: ["required", "max:255"])
        description: String @rules(apply: ["max:255"])
        precio: Int @rules(apply: ["integer"])
        amount: Int @rules(apply: ["integer"])
    ): Product @create(model: "App\\Product")
    updateProduct(
        id_product: ID! @rules(apply: ["required"])
        id_category: Int! @rules(apply: ["required"])
        name: String! @rules(apply: ["required", "max:255"])
        description: String @rules(apply: ["max:255"])
        precio: Int @rules(apply: ["integer"])
        amount: Int @rules(apply: ["integer"])
    ): Product @update(model: "App\\Product")
    #order
    createOrder(
        id_members: Int! @rules(apply: ["required","integer"])
        name: String! @rules(apply: ["required", "max:255"])
        code: String! @rules(apply: ["required","max:255"])
        description: String @rules(apply: ["max:255"])
        date_order: Date! @rules(apply: ["required", "date", "before:tomorrow"])
        notes: String @rules(apply: ["max:255"])
    ): Order @create(model: "App\\Order")
    updateOrder(
        id_order:ID! @rules(apply:["required"])
        id_members: Int! @rules(apply: ["required","integer"])
        name: String! @rules(apply: ["required", "max:255"])
        code: String! @rules(apply: ["required","max:255"])
        description: String @rules(apply: ["max:255"])
        date_order: Date! @rules(apply: ["required", "date", "before:tomorrow"])
        notes: String @rules(apply: ["max:255"])
    ): Order @update(model: "App\\Order")
    #order
    createDetail(
        id_product: Int! @rules(apply: ["required","integer"])
        id_order: Int! @rules(apply: ["required","integer"])
        quantity: Int! @rules(apply: ["required", "integer"])
        value: Int! @rules(apply: ["required", "integer"])
        cost: Int! @rules(apply: ["required", "integer"])
        measure: String @rules(apply: ["max:255"])
    ): Detail @create(model: "App\\Detail")
}




